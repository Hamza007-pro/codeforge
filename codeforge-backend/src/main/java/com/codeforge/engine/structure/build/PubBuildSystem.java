package com.codeforge.engine.structure.build;

import com.codeforge.engine.structure.dependency.Dependency;
import java.util.List;
import java.util.stream.Collectors;

public class PubBuildSystem implements BuildSystem {
    @Override
    public String getName() {
        return "pub";
    }

    @Override
    public String getConfigFileExtension() {
        return "yaml";
    }

    @Override
    public String formatDependencies(List<Dependency> dependencies) {
        return dependencies.stream()
            .map(d -> String.format("  %s: ^%s", d.getArtifactId(), d.getVersion()))
            .collect(Collectors.joining("\n"));
    }

    @Override
    public String createBuildConfig(String projectName, String version, List<Dependency> dependencies) {
        return """
            name: %s
            description: A Flutter project generated by CodeForge.
            version: %s
            
            environment:
              sdk: '>=3.2.3 <4.0.0'
            
            dependencies:
              flutter:
                sdk: flutter
            %s
            
            dev_dependencies:
              flutter_test:
                sdk: flutter
              flutter_lints: ^3.0.1
            
            flutter:
              uses-material-design: true
              assets:
                - assets/images/
                - assets/icons/
            """.formatted(projectName, version, formatDependencies(dependencies));
    }

    @Override
    public String getBuildCommand() {
        return "flutter build";
    }

    @Override
    public String getRunCommand() {
        return "flutter run";
    }

    @Override
    public String getTestCommand() {
        return "flutter test";
    }

    public String createAnalysisOptions() {
        return """
            include: package:flutter_lints/flutter.yaml
            
            linter:
              rules:
                - camel_case_types
                - library_private_types_in_public_api
                - avoid_print
                - prefer_single_quotes
                - sort_child_properties_last
            
            analyzer:
              exclude:
                - '**/*.g.dart'
                - '**/*.freezed.dart'
              errors:
                invalid_annotation_target: ignore
            """;
    }
}
